## Теория типов

Не все согласны с терминологией, используемой при обсуждении типовых систем. Поэтому давайте уточним несколько терминов
так, как они будут использоваться здесь.

**Сила типовой системы** — сильная или слабая типизация — определяет, может ли переменная изменить свой тип после того,
как он был задан. Простой пример: если у нас есть строковая переменная `$a = 'test';`, то слабая типовая система
позволяет переопределить эту переменную другим типом, например, `$a = 1` (целое число).

PHP является языком со слабой типизацией. Давайте рассмотрим, что это означает на практике.

```php
$id = '1'; // Например, идентификатор, полученный из URL
function find(int $id): Model
{
    // Значение '1' автоматически будет преобразовано в int
}
find($id);
```

Чтобы прояснить: слабая типизация PHP имеет смысл. Поскольку язык в основном работает с HTTP-запросами, практически все
данные фактически являются строками.

Вы можете предположить, что в современном PHP вы можете избежать этого скрытого переключения типов — так называемого "
жонглирования типами" (type juggling) — используя механизм строгой типизации (strict types). Однако это не совсем так.
Объявление строгой типизации предотвращает передачу значений неподходящих типов в функцию, но внутри самой функции вы
все равно можете изменить тип значения переменной.

```php
declare(strict_types=1);

function find(int $id): Model
{
    $id = '' . $id;
    /*
    * Это абсолютно разрешено в PHP.
    * Теперь `$id` является строкой.
    */
}

find('1'); // Это вызовет TypeError.
find(1);   // А это будет работать нормально.
```

Даже с использованием строгой типизации (`strict_types`) и подсказок типов (type hints) типовая система PHP остается
слабой. Подсказки типов гарантируют соответствие типа переменной лишь в момент проверки, без каких-либо гарантий на
будущее значение, которое переменная может принять.

Как уже упоминалось ранее, слабая типизация PHP логична, поскольку все входные данные, с которыми язык работает,
изначально представлены в виде строк. Однако у сильной типизации есть одно интересное свойство: она предоставляет
определенные гарантии. Если тип переменной неизменяем, то широкий спектр неожиданных ситуаций становится просто
невозможным. Благодаря этому исключаются многие потенциальные ошибки или непредсказуемое поведение, которое могло бы
возникнуть при изменении типа.

Вы ведь понимаете, что это математически доказано: если программа, написанная на языке с сильной типизацией,
компилируется, то в ней невозможно наличие целого ряда ошибок, которые могут существовать в языках со слабой типизацией.
Другими словами, сильная типизация предоставляет программисту лучшую гарантию того, что код работает так, как
предполагается.

Небольшое примечание: это не означает, что в языке с сильной типизацией не может быть багов! Никто не отменял
возможность написать неверную реализацию алгоритма или логику с ошибками. Однако если программа на языке с сильной
типизацией прошла успешную компиляцию, можно быть уверенным, что определенный набор ошибок и несоответствий, связанных с
типами данных, в этой программе отсутствует.

> Сильные системы типов позволяют разработчикам получить гораздо больше понимания программы во время написания кода,
> вместо необходимости запускать его.

Есть ещё одна концепция, которую нужно рассмотреть: статические и динамические системы типов — и именно здесь всё
становится интересным.

Как вы, вероятно, знаете, PHP является интерпретируемым языком, что означает, что PHP-скрипт преобразуется в машинный
код во время выполнения. Когда вы отправляете запрос на сервер, работающий с PHP, он берёт обычные файлы с расширением
`.php` и преобразует этот текст во что-то, что может выполнить процессор.

Снова-таки, это одна из сильных сторон PHP: простота написания скрипта, обновления страницы — и всё работает. Это
большое преимущество по сравнению с языками, которые требуют компиляции перед выполнением.

Очевидно, что существуют механизмы кэширования, которые оптимизируют этот процесс, так что приведённое выше объяснение
является упрощением, но его достаточно, чтобы перейти к следующему пункту.

А он заключается в том, что, как и прежде, у такого подхода PHP есть недостаток: поскольку типы проверяются только во
время выполнения, могут возникнуть ошибки типов, которые приведут к сбою программы во время её работы. Конечно, вы
получите ясную ошибку для отладки, но программа всё равно уже упала.

Проверка типов во время выполнения делает PHP динамически типизированным языком. С другой стороны, в статически
типизированных языках вся проверка типов выполняется до запуска кода, как правило, на этапе компиляции.

Начиная с версии PHP 7.0, система типов была существенно улучшена. Настолько, что инструменты вроде PHPStan, Phan и
Psalm стали очень популярными в последнее время. Эти инструменты работают с динамическим языком PHP, но выполняют
множество статических анализов вашего кода.

Эти библиотеки, которые можно использовать по желанию, предоставляют большое количество данных о вашем коде без
необходимости его выполнения или запуска юнит-тестов. Более того, IDE, такие как PhpStorm, имеют встроенные функции для
выполнения многих из этих статических проверок.

С учётом всей этой информации самое время вернуться к ядру нашего приложения — данным.
